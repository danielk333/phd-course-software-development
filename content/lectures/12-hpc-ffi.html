---
title: "Parallelization and foreign function interfaces"
description: ""
handout: hpc-ffi
weight: 12
---

<div class="reveal">
    <div class="slides">

        <section
            data-auto-animate
            data-background-image="media/c_python_funny.png"
            data-background-opacity="1"
        >
            <div class="centered-container"></div>
        </section>

        <section
            data-auto-animate
            data-background-image="media/c_python_funny.png"
            data-background-opacity="0.1"
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul class="fragment">
                    <li>The basics of parallelization</li>
                    <li>Ways to parallelize</li>
                    <li>High performance computing</li>
                    <li>Foreign function interfaces and calling conventions</li>
                    <li>Calling C/C++/Fortran from Python</li>
                </ul>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>The basics of parallelization</li>
                </ul>
                <ul>
                    <p>Two types</p>
                    <li class="fragment">Trivial parallelization</li>
                    <li class="fragment">The rest</li>
                </ul>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>The basics of parallelization</li>
                </ul>
                <ul>
                    <li>Trivial parallelization</li>
                </ul>
                <p>Independent calculations</p>
                <p>Node 1: $a+b$</p>
                <p>Node 2: $x/y$</p>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>The basics of parallelization</li>
                </ul>
                <ul>
                    <li>The rest</li>
                </ul>
                <p>Everything between trivial and not possible</p>
                <p>Can parallelize: $a + b + c + d + e$</p>
                <p>Can not parallelize: $f(f(f(f(x_0))))$</p>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>The basics of parallelization</li>
                </ul>
                <ul>
                    <li>The rest</li>
                </ul>
                <p>$a + b + c + d + e + f + g + h = y$</p>
                <img src="media/Binomial_tree_1.png" class="fragment" style="height: 50vh;">
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>The basics of parallelization</li>
                </ul>
                <ul>
                    <li>The rest</li>
                </ul>
                <p>$2 + 3 + 5 + 1 + 7 + 6 + 8 + 4 = y$</p>
                <img src="media/Binomial_tree_2.png" style="height: 50vh;">
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>The basics of parallelization</li>
                </ul>
                <ul>
                    <li>The rest</li>
                </ul>
                <p>$2 + 3 + 5 + 1 + 7 + 6 + 8 + 4 = y$</p>
                <img src="media/Binomial_tree_3.png" style="height: 50vh;">
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>The basics of parallelization</li>
                </ul>
                <ul>
                    <li>The rest</li>
                </ul>
                <p>$2 + 3 + 5 + 1 + 7 + 6 + 8 + 4 = 36$</p>
                <img src="media/Binomial_tree_4.png" style="height: 50vh;">
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>The basics of parallelization</li>
                </ul>
                <ul>
                    <li>The rest</li>
                </ul>
                <p class="mark">This is called a Binomial tree</p>
                <p class="mark">Not quite $n$ speedup, rather</p>
                <div class="fragment">
                    $$
                    T = \frac{N}{n} + 2 \log_2{n}
                    $$
                </div>
                <img src="media/example_binom_tree.png" class="fragment light" style="height: 30vh;">
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>The basics of parallelization</li>
                </ul>
                <ul>
                    <li>The rest</li>
                </ul>
                <img src="media/example_binom_tree.png" class="fragment light" style="height: 60vh;">
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>The basics of parallelization</li>
                </ul>
                <ul>
                    <li>The rest</li>
                </ul>
                <p>Any associative binary operator $T$ works!</p>
                $$
                    (x T y) T z = x T (y T z) \;\forall\; x,y,z
                $$
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>The basics of parallelization</li>
                </ul>
                <ul>
                    <li>The rest</li>
                </ul>
                <p class="highlight">We can also sometimes cheat</p>
                <p class="fragment">$y = f(f(f(f(x_0))))$</p>
                <ul class="fragment">
                    <li>Use trivial parallelization to pre-calculate $f(x)$ table</li>
                    <li>Then approximate $y$ single threaded REALLY FAST</li>
                </ul>
            </div>
        </section>



        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>The basics of parallelization</li>
                </ul>
                <div class="fragment">
                    <p>A model of your program execution time</p>
                    $$
                        T = \sum_{i=1}^{N} T_i
                    $$
                    <ul class="fragment">
                        <li>$T_1 = 1.1$ sec - load the data</li>
                        <li>$T_2 = 123.9$ sec - process the data</li>
                        <li>$T_3 = 0.2$ sec - save the results</li>
                    </ul>
                </div>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>The basics of parallelization</li>
                </ul>
                <p>Parallelization speedup $s_i(n)$<br>$n$ is core/node count</p>
                <div class="fragment">
                    $$
                        T(n) = \sum_{i=1}^{N} \frac{T_i}{s_i(n)}
                    $$
                </div>
                <ul class="fragment">
                    <li>$s_1(n) = 1$</li>
                    <li>$s_2(n) = n$</li>
                    <li>$s_3(n) = 1$</li>
                </ul>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>The basics of parallelization</li>
                </ul>
                $$
                    T(n) = T_1 + T_3 + \frac{T_2}{n}
                $$
                <img src="media/example_exec_time.png" class="fragment light" style="height: 40vh;">
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>The basics of parallelization</li>
                </ul>
                <img src="media/example_exec_time.png" class="fragment light" style="height: 65vh;">
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>The basics of parallelization</li>
                </ul>
                <p>So what is speedup?</p>
                <div class="fragment">
                    $$
                        S(n) = \frac{T(1)}{T(n)}
                    $$
                </div>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>The basics of parallelization</li>
                </ul>
                <p class="highlight">This is what is called Amdahl's law: total speedup $S$ is</p>
                $$
                S(n) = \frac{1}{1 - p + \frac{p}{s(n)}}
                $$
                <ul>
                    <li>$p$ optimized portion of code</li>
                    <li>$s$ speedup of optimized portion of code</li>
                    <li class="fragment">Remember: Fixed problem size!</li>
                    <li class="fragment">Remember: Parallelization is not always $n^{-1}$!</li>
                    <li class="fragment">Remember: Not just parallelization!<br>can also estimate gain
                    from other optimizations</li>
                </ul>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>The basics of parallelization</li>
                </ul>
                <p>What if problem size scales?</p>
                <div class="fragment">
                    $$
                        T(n) = \sum_{i=1}^{N} \frac{M_i(n)}{s_i(n)}T_i
                    $$
                </div>
                <ul class="fragment">
                    <li>$\frac{M_1(n)}{s(n)} = 1$</li>
                    <li>$\frac{M_2(n)}{s(n)} = n$</li>
                    <li>$\frac{M_3(n)}{s(n)} = 1$</li>
                </ul>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>The basics of parallelization</li>
                </ul>
                $$
                    T(n) = T_1 + T_3 + n T_2
                $$
                <img src="media/example_exec_time_scaling.png" class="fragment light" style="height: 40vh;">
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>The basics of parallelization</li>
                </ul>
                <img src="media/example_exec_time_scaling.png" class="light" style="height: 65vh;">
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>The basics of parallelization</li>
                </ul>
                <p class="highlight">This is what is called Gustafson's law: total speedup $S$ is</p>
                $$
                S(n) = 1 + (n - 1) p 
                $$
                <ul>
                    <li>$p$ parallel portion of code</li>
                    <li>parallel code is trivially parallel and scales with $n$</li>
                    <li class="fragment">Remember: Scaling problem size!</li>
                </ul>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>The basics of parallelization</li>
                </ul>
                <p class="highlight">So how to use this?</p>
                <ul>
                    <li class="fragment">Determine the trivially parallel part $p$ and its time $T_p$</li>
                    <li class="fragment">E.g. by fitting measurements or profiling</li>
                    <li class="fragment">Compute the scaling law you want</li>
                    <li class="fragment">Make decisions</li>
                </ul>
                <p class="fragment">(all scripts for plots and methods in repository)</p>
                <p class="fragment select">Practical example</p>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>The basics of parallelization</li>
                </ul>
                <p class="select">Practical example</p>
                <ul>
                    <li>Test particle integration</li>
                    <li>Max size for local testing 1 000 particles</li>
                    <li>Target size of 1 000 000 particles</li>
                    <li>$n$ cores and $N$ particles</li>
                </ul>
                <div class="fragment">
                    $$
                        T(n) = \frac{n}{n} T_b + T_p \frac{N}{n} = T_b + T_p \frac{N}{n}
                    $$
                </div>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>The basics of parallelization</li>
                </ul>
                <p class="select">Practical example</p>
                <div>
                    $$
                        T(n) = T_b + T_p \frac{N}{1}
                    $$
                </div>
                <p class="highlight">Data!</p>
                <img src="media/example_T_estimate.png" class="fragment light" style="height: 30vh;">
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>The basics of parallelization</li>
                </ul>
                <img src="media/example_T_estimate.png" class="light" style="height: 60vh;">
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>The basics of parallelization</li>
                </ul>
                $$
                    T(n) = T_b + T_p \frac{N}{n}
                $$
                <ul>
                    <li>$T_b$ = 3542 s</li>
                    <li>$T_p$ = 45 s</li>
                    <li>$N$ = [100 000, 1 000 000]</li>
                </ul>
                <img src="media/example_hpc_estimate.png" class="fragment light" style="height: 30vh;">
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>The basics of parallelization</li>
                </ul>
                <img src="media/example_hpc_estimate.png" class="fragment light" style="height: 55vh;">
                <p class="fragment highlight">Best trade-off: 700 000 particles at 500 cores ~20
                    hours</p>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>The basics of parallelization</li>
                    <li>Ways to parallelize</li>
                    <li>High performance computing</li>
                    <li>Foreign function interfaces and calling conventions</li>
                    <li>Calling C/C++/Fortran from Python</li>
                </ul>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>Ways to parallelize</li>
                </ul>
                <div class="fragment row-flex-c" style="align-items: start;">
                    <ul>
                        <p class="mark">Languages</p>
                        <li>Chapel</li>
                        <p class="mark">Python</p>
                        <li>Multiprocessing</li>
                        <li>Threading</li>
                        <li>Subprocess</li>
                        <li>dask/...</li>
                    </ul>
                    <ul style="padding-left: 2em;">
                        <p class="mark">Multi-lingual</p>
                        <li>MPI</li>
                        <li>Scripting</li>
                        <li>...</li>
                        <p class="mark">HPC frameworks</p>
                        <li>spark</li>
                        <li>...</li>
                    </ul>    
                </div>
                <p class="fragment">More stuff on: <br><a
                    href="https://github.com/trevor-vincent/awesome-high-performance-computing">trevor-vincent/awesome-high-performance-computing</a></p>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>Ways to parallelize</li>
                </ul>
                <div>
                    <ul>
                        <li>Chapel</li>
                    </ul>
                </div>
                <pre class="show-code">
                    <code data-line-numbers data-trim class="language-plaintext">
                        <!--
                        // print a message per compute node
                        coforall loc in Locales do
                          on loc do
                            writeln("Hello from locale ", loc.id);

                        // print a message per core per compute node
                        coforall loc in Locales do
                          on loc do
                            coforall tid in 0..<here.maxTaskPar do
                              writeln("Hello from task ", tid, " on locale ", loc.id);

                        // print 1,000 messages in parallel using all nodes and cores
                        use BlockDist;
                        const Inds = blockDist.createDomain(1..1000);
                        forall i in Inds do
                          writeln("Hello from iteration ", i, " running on locale ", here.id);
                        -->
                    </code>
                </pre>
                <p>No highlighting yet so lets go to: <a href="https://chapel-lang.org/">chapel-lang.org</a></p>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>Ways to parallelize</li>
                </ul>
                <div>
                    <ul>
                        <li>Threading</li>
                    </ul>
                </div>
                <p>Single node - same interpreter (and GIL) - shared memory</p>
                <pre class="fragment show-code">
                    <code data-line-numbers data-trim class="language-python">
                        from threading import Thread

                        def worker(index):
                            print(f"Worker doing {index}")

                        th = []
                        for ind in range(6):
                            t = Thread(target=worker, args=(ind,))
                            th.append(t)
                            t.start()

                        for t in th:
                            t.join()
                    </code>
                </pre>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>Ways to parallelize</li>
                </ul>
                <div>
                    <ul>
                        <li>Multiprocessing</li>
                    </ul>
                </div>
                <p>Single node - multiple cores - shared memory possible</p>
                <pre class="fragment show-code">
                    <code data-line-numbers data-trim class="language-python">
                        from multiprocessing import Process

                        def worker(index):
                            print(f"Worker doing {index}")

                        ps = []
                        for ind in range(6):
                            p = Process(target=worker, args=(ind,))
                            ps.append(p)
                            p.start()

                        for p in ps:
                            p.join()
                    </code>
                </pre>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>Ways to parallelize</li>
                </ul>
                <div>
                    <ul>
                        <li>Multiprocessing</li>
                    </ul>
                </div>
                <p>Single node - multiple cores - shared memory possible</p>
                <pre class="show-code">
                    <code data-line-numbers data-trim class="language-python">
                        from multiprocessing import Pool

                        def f(x):
                            return x * x

                        with Pool(5) as p:
                            par_computed_map = p.map(f, range(100))
                            print(par_computed_map)
                    </code>
                </pre>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>Ways to parallelize</li>
                </ul>
                <div>
                    <ul>
                        <li>Multiprocessing</li>
                    </ul>
                </div>
                <p>Single node - multiple cores - shared memory possible</p>
                <pre class="show-code">
                    <code data-line-numbers data-trim class="language-python" style="height: 45vh;">
                        import multiprocessing as mp
                        import numpy as np
                        import time


                        def worker(q, r, pid):
                            num = 0
                            while True:
                                data = q.get()
                                if data is None:
                                    print("Stopping worker now...")
                                    break
                                print(f"{pid=} doing task={num}")
                                for ind in range(1_000):
                                    res = np.mean(data)
                                r.put(res)
                                q.task_done()
                                num += 1


                        tasks = mp.JoinableQueue()
                        results = mp.Queue()

                        # create workers
                        ps = []
                        for i in range(6):
                            p = mp.Process(target=worker, args=(tasks, results, i))
                            ps.append(p)
                            p.start()

                        task_n = 500

                        t0 = time.time()

                        # queue tasks
                        for i in range(task_n):
                            tasks.put(np.random.randn(10_000) + i**2)

                        tasks.join()  # complete tasks

                        # get results
                        means = np.empty(task_n)
                        for i in range(task_n):
                            means[i] = results.get()

                        t1 = time.time() - t0
                        print(f"EXECUTION: {t1:.4f}")

                        # stop workers
                        for i in range(len(ps)):
                            tasks.put(None)
                        for p in ps:
                            p.join()
                    </code>
                </pre>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>Ways to parallelize</li>
                </ul>
                <div>
                    <ul>
                        <li>Subprocess</li>
                    </ul>
                </div>
                <p>Launches other programs - single node - multiple cores</p>
                <pre class="fragment show-code">
                    <code data-line-numbers data-trim class="language-python">
                        import subprocess

                        addrs = "192.167.0.{:d}"
                        prog = "ping "
                        opts = "-c 1 "

                        processes = []
                        for ind in range(256):
                            cmd = " ".join(["ping", f"192.167.0.{ind:d}", "-c", "1"])
                            print(f"starting '{cmd}'")
                            p = subprocess.Popen(cmd, cwd="/", shell=True)
                            processes.append(p)

                        for p in processes:
                            p.wait()
                    </code>
                </pre>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>Ways to parallelize</li>
                </ul>
                <div>
                    <ul>
                        <li>MPI</li>
                    </ul>
                </div>
                <p>Multi-node / local / multi-core - inter-process communication</p>
                <ul class="fragment">
                    <li><code>pacman -S openmpi</code></li>
                    <li><code>pip install mpi4py</code></li>
                    <li><code>mpirun -np 6 python code/python-scripts/mpi_hello.py</code></li>
                </ul>
                <pre class="fragment show-code">
                    <code data-line-numbers data-trim class="language-python">
                        #!/usr/bin/env python
                        from mpi4py import MPI

                        comm = MPI.COMM_WORLD
                        name = MPI.Get_processor_name()
                        print(f"hello! name: {name}, my rank is {comm.rank}")
                    </code>
                </pre>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>Ways to parallelize</li>
                </ul>
                <div>
                    <ul>
                        <li>MPI</li>
                    </ul>
                </div>
                <p>Multi-node / local / multi-core - inter-process communication</p>
                <pre class="show-code">
                    <code data-line-numbers data-trim class="language-python" style="height: 45vh;">
                        #!/usr/bin/env python
                        import time
                        from mpi4py import MPI
                        import numpy as np

                        comm = MPI.COMM_WORLD

                        t0_all = time.time()
                        print(f"rank-{comm.rank}/{comm.size} starting")

                        if comm.rank == 0:
                            items = [np.random.random(1000) + x for x in range(10000)]
                        else:
                            items = None

                        items = comm.bcast(items, root=0)
                        t0 = time.time()

                        for ind in range(comm.rank, len(items), comm.size):
                            items[ind] = items[ind] - np.mean(items[ind])

                        dt = time.time() - t0

                        if comm.rank == 0:
                            for rank in range(1, comm.size):
                                for ind in range(rank, len(items), comm.size):
                                    items[ind] = comm.recv(source=rank, tag=ind)
                        else:
                            for ind in range(comm.rank, len(items), comm.size):
                                comm.send(items[ind], dest=0, tag=ind)

                        if comm.rank == 0:
                            su = 0
                            for dat in items:
                                su += np.mean(dat)

                        dt_all = time.time() - t0_all
                        print(f"rank-{comm.rank}/{comm.size}: work time {dt} s (total {dt_all} s)")
                    </code>
                </pre>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>Ways to parallelize</li>
                </ul>
                <div>
                    <ul>
                        <li>Scripting</li>
                    </ul>
                </div>
                <ul>
                    <li>snakemake</li>
                    <li>make</li>
                    <li>bash</li>
                    <li>...</li>
                </ul>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>Ways to parallelize</li>
                </ul>
                <p class="mark">What about this Global Interpreter Lock (GIL)?</p>
                <pre class="fragment show-code">
                    <code data-line-numbers data-trim class="language-python" style="height: 45vh;">
                        import time
                        from threading import Thread
                        from multiprocessing import Pool

                        iter_num = 60000000

                        def counter(num):
                            while num != 0:
                                num -= 1

                        t1 = Thread(target=counter, args=(iter_num // 2,))
                        t2 = Thread(target=counter, args=(iter_num // 2,))

                        start = time.time()
                        t1.start()
                        t2.start()
                        t1.join()
                        t2.join()
                        end = time.time()

                        print("threading exec time -", end - start)


                        start = time.time()
                        counter(iter_num)
                        end = time.time()

                        print("linear exec time -", end - start)

                        pool = Pool(2)

                        start = time.time()

                        r1 = pool.apply_async(counter, [iter_num // 2])
                        r2 = pool.apply_async(counter, [iter_num // 2])
                        pool.close()
                        pool.join()

                        end = time.time()

                        print("multiprocessing exec time -", end - start)
                    </code>
                </pre>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>The basics of parallelization</li>
                    <li>Ways to parallelize</li>
                    <li>High performance computing</li>
                    <li>Foreign function interfaces and calling conventions</li>
                    <li>Calling C/C++/Fortran from Python</li>
                </ul>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>High performance computing</li>
                </ul>
                <ul class="fragment">
                    <li>Virtual/shared file systems</li>
                    <li>Resource manager</li>
                    <li>HPC and IRF</li>
                </ul>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>High performance computing</li>
                </ul>
                <ul>
                    <li>Virtual/shared file systems</li>
                </ul>
                <img src="media/RAID_0.png" style="height: 50vh;">
                <p class="figure-credit">Wikimedia:User:Cburnett CC-BY-SA-3.0</p>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>High performance computing</li>
                </ul>
                <ul>
                    <li>Virtual/shared file systems</li>
                </ul>
                <img src="media/RAID_1.png" style="height: 50vh;">
                <p class="figure-credit">Wikimedia:User:Cburnett CC-BY-SA-3.0</p>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>High performance computing</li>
                </ul>
                <ul>
                    <li>Virtual/shared file systems</li>
                </ul>
                <img src="media/RAID_3.png" style="height: 50vh;">
                <p class="figure-credit">Wikimedia:User:Cburnett CC-BY-SA-3.0</p>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>High performance computing</li>
                </ul>
                <ul>
                    <li>Virtual/shared file systems</li>
                </ul>
                <p>You can also do it in software! For example ZFS</p>
                <img src="media/zfs.png" class="light" style="height: 50vh;">
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>High performance computing</li>
                </ul>
                <ul>
                    <li>Virtual/shared file systems</li>
                </ul>
                <p class="mark">Special file systems for HPC's</p>
                <ul>
                    <li>lustre (used by HPC2N)</li>
                    <li>HDFS (Hadoop Distributed File System)</li>
                    <li>DAOS (Distributed Asynchronous Object Storage)</li>
                    <li>BeeGFS</li>
                    <li>...</li>
                </ul>
                <p class="fragment highlight">What they do:<br>distribute large amounts of data over
                    distributed storage and makes sure your code and data is available at the
                    correct compute node</p>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>High performance computing</li>
                </ul>
                <ul>
                    <li>Resource manager</li>
                </ul>
                <p class="mark">Special managers for HPC's</p>
                <ul>
                    <li>Slurm (used by HPC2N)</li>
                    <li>Hadoop YARN</li>
                    <li>..</li>
                </ul>
                <p class="fragment highlight">What they do:<br>Makes sure everyone gets their job
                    run when the cluster is available and with the correct setup</p>
                <p class="fragment">You need to learn your system! How do you submit jobs, how do
                    you make batches, is MPI supported, which catalogues are distributed, etc.</p>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>High performance computing</li>
                </ul>
                <ul>
                    <li>HPC and IRF</li>
                </ul>
                <p>HPC2N (High Performance Computing Center
                    North)</p>
                <ul class="list-sep">
                    <li class="fragment">IRF is a partner in HPC2N witch means we are allotted special access</li>
                    <li class="fragment">Loads of info on: <a href="https://www.hpc2n.umu.se/">hpc2n.umu.se</a></li>
                    <li class="fragment">HPC2N contact person at IRF: <span class="highlight">Mats Holmström</span></li>
                    <li class="fragment">Anyone can register an account at: <a href="https://supr.snic.se/">supr.snic.se</a></li>
                </ul>
            </div>
        </section>


        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>The basics of parallelization</li>
                    <li>Ways to parallelize</li>
                    <li>High performance computing</li>
                    <li>Foreign function interfaces and calling conventions</li>
                    <li>Calling C/C++/Fortran from Python</li>
                </ul>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>Foreign function interfaces and calling conventions</li>
                </ul>
                <ul>
                    <li>Foreign function interfaces</li>
                    <li>Calling conventions</li>
                </ul>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>Foreign function interfaces and calling conventions</li>
                </ul>
                <ul>
                    <li>Foreign function interfaces</li>
                </ul>
                <p>A system by which a programming language can call functions from a
                    library/package/compiled binary from another programming language</p>
                <p class="fragment mark">For example: pretty much every language has to have a C FFI <br>(blog post in
                    handout)</p>
                <p class="fragment">Python developers want to implement the <code>open</code> a file
                    on disk function... how do they do that?</p>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>Foreign function interfaces and calling conventions</li>
                </ul>
                <ul>
                    <li>Foreign function interfaces</li>
                </ul>
                <p class="fragment">Python developers want to implement the <code>open</code> a file
                    on disk function... how do they do that?</p>
                <p class="mark">Lets look at the Linux System Calls Manual</p>
                <pre class="fragment show-code">
                    <code data-line-numbers data-trim class="language-plaintext" style="height: 40vh;">
                        open(2)                     System Calls Manual                    open(2)

                        NAME
                               open, openat, creat - open and possibly create a file

                        LIBRARY
                               Standard C library (libc, -lc)

                        SYNOPSIS
                               #include <fcntl.h>

                               int open(const char *pathname, int flags, ...
                                          /* mode_t mode */ );

                               int creat(const char *pathname, mode_t mode);

                               int openat(int dirfd, const char *pathname, int flags, ...
                                          /* mode_t mode */ );

                               /* Documented separately, in openat2(2): */
                               int openat2(int dirfd, const char *pathname,
                                          const struct open_how *how, size_t size);

                        DESCRIPTION
                               The  open()  system  call opens the file specified by pathname.  If
                               the specified file does not exist, it may optionally (if O_CREAT is
                               specified in flags) be created by open().

                               The return value of open() is a file descriptor, a small,  nonnega‐
                               tive integer that is an index to an entry in the process's table of
                               open  file  descriptors.  The file descriptor is used in subsequent
                               system calls (read(2), write(2), lseek(2), fcntl(2), etc.)  to  re‐
                               fer to the open file.  The file descriptor returned by a successful
                               call will be the lowest-numbered file descriptor not currently open
                               for the process.
                            ...
                    </code>
                </pre>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>Foreign function interfaces and calling conventions</li>
                </ul>
                <ul>
                    <li>Foreign function interfaces</li>
                </ul>
                <pre class="show-code">
                    <code data-line-numbers data-trim class="language-plaintext" style="height: 20vh;">
                        open(2)                     System Calls Manual                    open(2)

                        NAME
                               open, openat, creat - open and possibly create a file

                        LIBRARY
                               Standard C library (libc, -lc)

                        SYNOPSIS
                               #include <fcntl.h>

                               int open(const char *pathname, int flags, ...
                                          /* mode_t mode */ );

                               int creat(const char *pathname, mode_t mode);

                               int openat(int dirfd, const char *pathname, int flags, ...
                                          /* mode_t mode */ );

                               /* Documented separately, in openat2(2): */
                               int openat2(int dirfd, const char *pathname,
                                          const struct open_how *how, size_t size);

                        DESCRIPTION
                               The  open()  system  call opens the file specified by pathname.  If
                               the specified file does not exist, it may optionally (if O_CREAT is
                               specified in flags) be created by open().

                               The return value of open() is a file descriptor, a small,  nonnega‐
                               tive integer that is an index to an entry in the process's table of
                               open  file  descriptors.  The file descriptor is used in subsequent
                               system calls (read(2), write(2), lseek(2), fcntl(2), etc.)  to  re‐
                               fer to the open file.  The file descriptor returned by a successful
                               call will be the lowest-numbered file descriptor not currently open
                               for the process.
                            ...
                    </code>
                </pre>
                <p>The language is Python not C - so cannot include</p>
                <p class="fragment">Code and maintain a direct Linux kernel interface (setting
                    correct registers ect)<br>... or</p>
                <p class="fragment">Somehow call the <code>open</code> symbol from libc</p>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>Foreign function interfaces and calling conventions</li>
                </ul>
                <ul>
                    <li>Calling conventions</li>
                </ul>
                <p>Somehow call the <code>open</code> symbol from libc</p>
                <pre class="fragment show-code">
                    <code data-line-numbers data-trim class="language-c">
                        int func(int a, int b) {
                            return a + b;
                        }

                        int main(void)
                        {
                            return func(1, 2);
                        }
                    </code>
                </pre>
                <pre class="fragment show-code">
                    <code data-line-numbers data-trim class="language-x86asm" style="height: 30vh;">
                        _Z4funcii:
                                push    rbp
                                mov     rbp, rsp
                                mov     DWORD PTR [rbp-4], edi
                                mov     DWORD PTR [rbp-8], esi
                                mov     edx, DWORD PTR [rbp-4]
                                mov     eax, DWORD PTR [rbp-8]
                                add     eax, edx
                                pop     rbp
                                ret
                        main:
                                push    rbp
                                mov     rbp, rsp
                                mov     esi, 2
                                mov     edi, 1
                                call    _Z4funcii
                                nop
                                pop     rbp
                                ret
                    </code>
                </pre>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <pre class="show-code">
                    <code data-line-numbers data-trim class="language-c">
                        int func(int a, int b) {
                            return a + b;
                        }

                        int main(void)
                        {
                            return func(1, 2);
                        }
                    </code>
                </pre>
                <pre class="show-code">
                    <code data-line-numbers data-trim class="language-x86asm">
                        _Z4funcii:
                                push    rbp
                                mov     rbp, rsp
                                mov     DWORD PTR [rbp-4], edi
                                mov     DWORD PTR [rbp-8], esi
                                mov     edx, DWORD PTR [rbp-4]
                                mov     eax, DWORD PTR [rbp-8]
                                add     eax, edx
                                pop     rbp
                                ret
                        main:
                                push    rbp
                                mov     rbp, rsp
                                mov     esi, 2
                                mov     edi, 1
                                call    _Z4funcii
                                nop
                                pop     rbp
                                ret
                    </code>
                </pre>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>Foreign function interfaces and calling conventions</li>
                </ul>
                <ul>
                    <li>Calling conventions</li>
                </ul>
                <p>Somehow call the <code>open</code> symbol from libc</p>
                <pre class="show-code">
                    <code data-line-numbers data-trim class="language-c" style="height: 10vh;">
                        int func(int a, int b) {
                            return a + b;
                        }

                        int main(void)
                        {
                            return func(1, 2);
                        }
                    </code>
                </pre>
                <pre class="show-code">
                    <code data-line-numbers data-trim class="language-x86asm" style="height: 10vh;">
                        _Z4funcii:
                                push    rbp
                                mov     rbp, rsp
                                mov     DWORD PTR [rbp-4], edi
                                mov     DWORD PTR [rbp-8], esi
                                mov     edx, DWORD PTR [rbp-4]
                                mov     eax, DWORD PTR [rbp-8]
                                add     eax, edx
                                pop     rbp
                                ret
                        main:
                                push    rbp
                                mov     rbp, rsp
                                mov     esi, 2
                                mov     edi, 1
                                call    _Z4funcii
                                nop
                                pop     rbp
                                ret
                    </code>
                </pre>
                <p class="fragment select">If you want to know more, have a look at the handout</p>
                <p class="fragment">For now: be glad all this is behind the Python implementation and...</p>
            </div>
        </section>
        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>Foreign function interfaces and calling conventions</li>
                </ul>
                <p>For now: be glad all this is behind the Python implementation and...</p>
                <pre class="show-code">
                    <code data-line-numbers data-trim class="language-python">
                        # The standard Python c-FFI!
                        import ctypes
                    </code>
                </pre>
                <p class="fragment">Now - if anything can talk C - we can talk to it!</p>
                <pre class="fragment show-code">
                    <code data-line-numbers data-trim class="language-c">
                        package main

                        import "core:c"
                        import "core:fmt"
                        import "base:runtime"

                        @export
                        logistic :: proc "c" (r, x: f64) -> f64 {
                            return r * x * (1 - x)
                        }
                    </code>
                </pre>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>The basics of parallelization</li>
                    <li>Ways to parallelize</li>
                    <li>High performance computing</li>
                    <li>Foreign function interfaces and calling conventions</li>
                    <li>Calling C/C++/Fortran from Python</li>
                </ul>
            </div>
        </section>


        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>Calling C/C++/Fortran from Python</li>
                </ul>
                <ul>
                    <li>ctypes</li>
                    <li>Python.h</li>
                    <li>cython</li>
                    <li>f2py</li>
                    <li>...</li>
                </ul>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>Calling C/C++/Fortran from Python</li>
                </ul>
                <ul>
                    <li>ctypes</li>
                </ul>
                <pre class="fragment show-code">
                    <code data-line-numbers data-trim class="language-c">
                        void twice(double* in_array, double* out_array, int length) {
                            int i;
                            for(i = 0; i&lt;length; i++) {
                                out_array[i] = in_array[i]*2;
                            }
                        }
                    </code>
                </pre>
                <p class="fragment"><code>gcc main.c -fPIC -shared -o main.so</code></p>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>Calling C/C++/Fortran from Python</li>
                </ul>
                <ul>
                    <li>ctypes</li>
                </ul>
                <pre class="show-code">
                    <code data-line-numbers data-trim class="language-c" style="height: 10vh;">
                        void twice(double* in_array, double* out_array, int length) {
                            int i;
                            for(i = 0; i&lt;length; i++) {
                                out_array[i] = in_array[i]*2;
                            }
                        }
                    </code>
                </pre>
                <pre class="show-code">
                    <code data-line-numbers data-trim class="language-python" style="height: 40vh;">
                        import ctypes

                        import numpy as np
                        import numpy.typing as npt
                        import numpy.ctypeslib as npct

                        lib = ctypes.cdll.LoadLibrary("./main.so")
                        # Define the data types we need
                        ro_f8_vec = npct.ndpointer(np.float64, ndim=1, flags="aligned, contiguous")
                        rw_f8_vec = npct.ndpointer(np.float64, ndim=1, flags="aligned, contiguous, writeable")

                        # Define the C-interface
                        lib.twice.restype = None
                        lib.twice.argtypes = [
                            ro_f8_vec,
                            rw_f8_vec,
                            ctypes.c_int,
                        ]


                        def twice(values: npt.NDArray[np.float64]):
                            result = np.empty_like(values)
                            length = ctypes.c_int(len(values))

                            lib.twice(values, result, length)

                            return result


                        if __name__ == "__main__":
                            x = np.arange(10, dtype=np.float64)

                            print("running c-twice")
                            y = twice(x)

                            print(f"INPUT : {x}")
                            print(f"OUTPUT: {y}")
                    </code>
                </pre>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>Calling C/C++/Fortran from Python</li>
                </ul>
                <ul>
                    <li>ctypes</li>
                    <li>Python.h</li>
                    <li>cython</li>
                    <li>f2py</li>
                    <li>...</li>
                </ul>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>Calling C/C++/Fortran from Python</li>
                </ul>
                <ul>
                    <li>Python.h</li>
                </ul>
                <p class="fragment">Let's say I wanted something like</p>
                <pre class="fragment show-code">
                    <code data-line-numbers data-trim class="language-python">
                        import bar

                        print("bar content: ", dir(bar))
                        print(bar.hello("Daniel"))
                    </code>
                </pre>
                <p class="fragment">But without <code>ctypes</code> while interfacing to a complicated C/C++ library</p>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>Calling C/C++/Fortran from Python</li>
                </ul>
                <ul>
                    <li>Python.h</li>
                </ul>
                <pre class="fragment show-code">
                    <code data-line-numbers data-trim class="language-c" style="height: 40vh;">
                        #define PY_SSIZE_T_CLEAN
                        #include <Python.h>
                        #include <string.h>

                        static PyObject* say_hello(PyObject *self, PyObject *args)
                        {
                            const char *name;
                            if (!PyArg_ParseTuple(args, "s", &name)) 
                            {
                                return NULL;
                            }
                            
                            size_t n = strlen(name);
                            size_t response_len = 7 + n + 1;
                            char *response = (char *)malloc(response_len);
                            if (!response) {
                                return PyErr_NoMemory();
                            }

                            strcpy(response, "Hello, ");
                            strcat(response, name);

                            PyObject *ret = Py_BuildValue("s", response);
                            free(response);
                            return ret;
                        }

                        /* Table of what is in this modeule*/
                        static PyMethodDef BarMethods[] = 
                        {
                            {"hello", say_hello, METH_VARARGS,
                             "Greets you!"},
                            {NULL, NULL, 0, NULL}        /* Sentinel */
                        };

                        /* Definition of the module */
                        static struct PyModuleDef barmodule = {
                            PyModuleDef_HEAD_INIT,
                            "bar",    /* name of module */
                            NULL,     /* module documentation, may be NULL */
                            -1,       /* size of per-interpreter state of the module,
                                         or -1 if the module keeps state in global variables. */
                            BarMethods
                        };

                        /* This actually creates the module using the module definition */
                        PyMODINIT_FUNC PyInit_bar(void)
                        {
                            return PyModule_Create(&barmodule);
                        }
                    </code>
                </pre>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>Calling C/C++/Fortran from Python</li>
                </ul>
                <ul>
                    <li>Python.h</li>
                </ul>
                <p>This can be directly compiled versus Python</p>
                <pre class="fragment show-code">
                    <code data-line-numbers data-trim class="language-make">
                        CFLAGS=$(shell python-config --cflags) -fPIC -shared
                        INCLUDES=$(shell python-config --includes)

                        build:
                            gcc $(INCLUDES) $(CFLAGS) bar.c -o bar.so
                    </code>
                </pre>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>Calling C/C++/Fortran from Python</li>
                </ul>
                <ul>
                    <li>ctypes</li>
                    <li>Python.h</li>
                    <li>cython</li>
                    <li>f2py</li>
                    <li>...</li>
                </ul>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>Calling C/C++/Fortran from Python</li>
                </ul>
                <ul>
                    <li>cython</li>
                </ul>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>Calling C/C++/Fortran from Python</li>
                </ul>
                <ul>
                    <li>ctypes</li>
                    <li>Python.h</li>
                    <li>cython</li>
                    <li>f2py</li>
                    <li>...</li>
                </ul>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>Calling C/C++/Fortran from Python</li>
                </ul>
                <ul>
                    <li>f2py</li>
                </ul>
                <pre class="fragment show-code">
                    <code data-line-numbers data-trim class="language-fortran">
                        subroutine fib(a,n)
                          integer, intent(in) :: n
                          integer, intent(out), dimension(1:n) :: a
                          
                          do i=1,n
                            if (i.eq.1) then
                               a(i) = 0
                            elseif (i.eq.2) then
                               a(i) = 1
                            else 
                               a(i) = a(i-1) + a(i-2)
                            endif
                          enddo
                        end
                    </code>
                </pre>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>Calling C/C++/Fortran from Python</li>
                </ul>
                <ul>
                    <li>f2py</li>
                </ul>
                <pre class="show-code">
                    <code data-line-numbers data-trim class="language-fortran" style="height: 20vh;">
                        subroutine fib(a,n)
                          integer, intent(in) :: n
                          integer, intent(out), dimension(1:n) :: a
                          
                          do i=1,n
                            if (i.eq.1) then
                               a(i) = 0
                            elseif (i.eq.2) then
                               a(i) = 1
                            else 
                               a(i) = a(i-1) + a(i-2)
                            endif
                          enddo
                        end
                    </code>
                </pre>
                <p><code>sudo pacman -S gcc-fortran meson</code></p>
                <p><code>python -m numpy.f2py -c fib.f90 -m fiblib</code></p>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <ul>
                    <li>Calling C/C++/Fortran from Python</li>
                </ul>
                <ul>
                    <li>f2py</li>
                </ul>
                <p><code>python -m numpy.f2py -c fib.f90 -m fiblib</code></p>
                <p class="fragment">creates <code>fiblib.cpython-313-x86_64-linux-gnu.so</code></p>
                <pre class="fragment show-code">
                    <code data-line-numbers data-trim class="language-python">
                        import fiblib
                        print(fiblib.fib.__doc__)

                        n = fiblib.fib(10)
                        print(f"{n=}")
                    </code>
                </pre>
            </div>
        </section>

        <section
            data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Parallelization and foreign function interfaces</h3>
                <p class="select">Let's check out the handout!</p>
            </div>
        </section>

    </div>
</div>

