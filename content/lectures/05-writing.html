---
title: "Writing code for Humans to read and Machines to run"
description: "The title really says it all. Code is both read and executed more times than it is written - so one should be very careful with compromising on the reading and the running in favour of quick writing. This lectures covers how to write code for humans to read and machines to run."
handout: writing
weight: 5
---

<div class="reveal">
    <div class="slides">

        <section
        data-auto-animate
        data-background-image="media/code.png"
        data-background-opacity="0.7"
        >
            <div class="centered-container">
            </div>
        </section>

        <section
        data-auto-animate
        data-background-image="media/code.png"
        data-background-opacity="0.15"
        >
            <div class="centered-container">
                <h3 class="title">Writing code for Humans to read and Machines to run</h3>
                <p class="fragment">Why worry about "reading"?</p>
                <ul class="fragment">
                    <p class="mark">As we already discussed:</p>
                    <li>You will need to read it again <span class="highlight">(maintainability)</span></li>
                    <li>Your colleagues might read it <span class="highlight">(collaboration)</span></li>
                    <li>You need to understand it <span class="highlight">(correctness/extensibility)</span></li>
                    <li>You/your colleagues/others will run it <span class="highlight">(usability)</span></li>
                </ul>
                <p class="fragment select">Categories of readability/comprehension/usability</p>
            </div>
        </section>

        <section data-auto-animate>
            <div class="centered-container">
                <h3 class="title">Writing code for Humans to read and Machines to run</h3>
                <p class="select">Categories of readability/comprehension/usability</p>
                <ul class="fragment">
                    <li>Readable code / style / formatting</li>
                    <li>Software design</li>
                    <li>Comments / docstrings</li>
                    <li>External documentation / manual</li>
                    <li>Examples / tests</li>
                    <li>Changelogs / READMEs / release notes</li>
                    <li>APIs / interfaces</li>
                    <li>CLIs / TUIs / GUIs</li>
                    <li>Configuration</li>
                    <li>Data formats</li>
                </ul>
                <p class="fragment mark">Lets go trough some things from each</p>
            </div>
        </section>

        <section data-auto-animate>
            <div class="centered-container">
                <h3 class="title">Writing code for Humans to read and Machines to run</h3>
                <ul>
                    <li>Readable code / style / formatting</li>
                </ul>
                <ul class="fragment">
                    <p class="mark">Some considerations</p>
                    <li>Variable / function / class names<br><span class="fragment highlight">$\mapsto$descriptive but concise</span></li>
                    <li>Terms / abbreviations / (natural) language<br><span class="fragment  highlight">$\mapsto$clear and defined</span></li>
                    <li>Limiting line-length<br><span class="fragment highlight">$\mapsto$~80-120 ish</span></li>
                    <li>Using intermediate variables / step-by-step<br><span class="fragment  highlight">$\mapsto$when clarity trumps efficiency</span></li>
                </ul>
            </div>
        </section>

        <section data-auto-animate>
            <div class="centered-container">
                <h3 class="title">Writing code for Humans to read and Machines to run</h3>
                <ul>
                    <li>Readable code / style / formatting</li>
                </ul>
                <pre class="fragment show-code">
                    <code data-line-numbers data-trim class="language-python">
                        def f(x, y): ...

                        # vs

                        def true_anomaly(mean_anomaly, eccentricity): ...
                    </code>
                </pre>
            </div>
        </section>

        <section data-auto-animate>
            <div class="centered-container">
                <h3 class="title">Writing code for Humans to read and Machines to run</h3>
                <ul>
                    <li>Readable code / style / formatting</li>
                </ul>
                <pre class="fragment show-code">
                    <code data-line-numbers data-trim class="language-python">
                        class AbstractInterruptibleBatchPreparedStatementSetter: ...

                        # vs (with some re-design)

                        class StatementSetter: ...
                    </code>
                </pre>
            </div>
        </section>

        <section data-auto-animate>
            <div class="centered-container">
                <h3 class="title">Writing code for Humans to read and Machines to run</h3>
                <ul>
                    <li>Readable code / style / formatting</li>
                </ul>
                <pre class="fragment show-code">
                    <code data-line-numbers data-trim class="language-python">
                        def gmf(zx, zr): ...

                        # vs

                        def generalized_match_function(
                            received_signal,
                            transmitted_signal,
                        ): ...
                    </code>
                </pre>
            </div>
        </section>

        <section data-auto-animate>
            <div class="centered-container">
                <h3 class="title">Writing code for Humans to read and Machines to run</h3>
                <ul>
                    <li>Readable code / style / formatting</li>
                </ul>
                <pre class="fragment show-code">
                    <code data-line-numbers data-trim class="language-python">
                    v[1:-1, 1:-1] = (vn[1:-1, 1:-1] - dt / dx * un[1:-1, 1:-1] * (vn[1:-1, 1:-1] - vn[1:-1, 0:-2]) - dt / dy * vn[1:-1, 1:-1] * (vn[1:-1, 1:-1] - vn[0:-2, 1:-1]) + nu * dt / dx**2 * (vn[1:-1, 2:] - 2 * vn[1:-1, 1:-1] + vn[1:-1, 0:-2]) + nu * dt / dy**2 * (vn[2:, 1:-1] - 2 * vn[1:-1, 1:-1] + vn[0:-2, 1:-1]))

                        # vs
                    v[1:-1, 1:-1] = (
                         vn[1:-1, 1:-1] - 
                         dt / dx * un[1:-1, 1:-1] *
                         (vn[1:-1, 1:-1] - vn[1:-1, 0:-2]) -
                         dt / dy * vn[1:-1, 1:-1] * 
                         (vn[1:-1, 1:-1] - vn[0:-2, 1:-1]) + 
                         nu * dt / dx**2 * 
                         (vn[1:-1, 2:] - 2 * vn[1:-1, 1:-1] + vn[1:-1, 0:-2]) +
                         nu * dt / dy**2 *
                         (vn[2:, 1:-1] - 2 * vn[1:-1, 1:-1] + vn[0:-2, 1:-1])
                    )
                    </code>
                </pre>
            </div>
        </section>

        <section data-auto-animate>
            <div class="centered-container">
                <h3 class="title">Writing code for Humans to read and Machines to run</h3>
                <ul>
                    <li>Readable code / style / formatting</li>
                </ul>
                <pre class="fragment show-code">
                    <code data-line-numbers data-trim class="language-python">
                        R[0, 0, ...] = np.cos(_Omega)*np.cos(_omega) - np.cos(_inc)*np.sin(_Omega)*np.sin(_omega)
                        R[1, 0, ...] = np.cos(_omega)*np.sin(_Omega) + np.cos(_Omega)*np.cos(_inc)*np.sin(_omega)
                        R[2, 0, ...] = np.sin(_inc)*np.sin(_omega)

                        # vs (also faster in this case!)
                        
                        # 3 rotations 
                        # First Long Asc. Node (Omega),
                        c1 = np.cos(_Omega)
                        s1 = np.sin(_Omega)

                        # then Inclination
                        c2 = np.cos(_inc)
                        s2 = np.sin(_inc)

                        # then Arg. Perihelion (omega)
                        c3 = np.cos(_omega)
                        s3 = np.sin(_omega)

                        R[0, 0, ...] = c1*c3 - c2*s1*s3
                        R[1, 0, ...] = c3*s1 + c1*c2*s3
                        R[2, 0, ...] = s2*s3
                    </code>
                </pre>
            </div>
        </section>

        <section data-auto-animate>
            <div class="centered-container">
                <h3 class="title">Writing code for Humans to read and Machines to run</h3>
                <ul>
                    <li>Readable code / style / formatting</li>
                </ul>
                <pre class="fragment show-code">
                    <code data-line-numbers data-trim class="language-python">
                        def foo(x): ...
                            """Den här dokumentationen kan bara läsas av de som kan svenska!
                            """

                        # vs

                        def foo(x): ...
                            """This documentation can only be read by people who know swedish!
                            """
                    </code>
                </pre>
            </div>
        </section>

        <section
        data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Writing code for Humans to read and Machines to run</h3>
                <ul>
                    <li>Readable code / style / formatting</li>
                </ul>
                <p>Lets test some practical considerations</p>
                <ul>
                    <li class="fragment">Install <a href="https://flake8.pycqa.org/en/latest/">flake8</a> or integrate it into your editor</li>
                    <li class="fragment">Run it on some of your code</li>
                    <li class="fragment">Disable some of the warning that are strange, edit line length, (use the <code>.flake8</code> file)</li>
                    <li class="fragment">Auto format the code with <a href="https://github.com/psf/black">black</a> or <a href="https://docs.astral.sh/ruff/formatter/">ruff</a></li>
                </ul>
            </div>
        </section>

        <section data-auto-animate>
            <div class="centered-container">
                <h3 class="title">Writing code for Humans to read and Machines to run</h3>
                <ul>
                    <li>Readable code / style / formatting</li>
                    <li>Software design</li>
                    <li>Comments / docstrings</li>
                    <li>External documentation / manual</li>
                    <li>Examples / tests</li>
                    <li>Changelogs / READMEs / release notes</li>
                    <li>APIs / interfaces</li>
                    <li>CLIs / TUIs / GUIs</li>
                    <li>Configuration</li>
                    <li>Data formats</li>
                </ul>
            </div>
        </section>

        <section data-auto-animate>
            <div class="centered-container">
                <h3 class="title">Writing code for Humans to read and Machines to run</h3>
                <ul>
                    <li>Software design</li>
                </ul>
                <div class="fragment">
                    <img src="media/comprehension.svg" alt="" style="width: 60vw;">
                    <p>(Plot idea stolen from "Software Design by Example" by Greg Wilson)</p>
                </div>
            </div>
        </section>

        <section
        data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Writing code for Humans to read and Machines to run</h3>
                <ul>
                    <li>Software design</li>
                </ul>
                <img src="media/comprehension.svg" alt="" style="width: 40vw;">
                <ul>
                    <p>Lets unpack the above a bit</p>
                    <li>TODO</li>
                </ul>
            </div>
        </section>

        <section data-auto-animate>
            <div class="centered-container">
                <h3 class="title">Writing code for Humans to read and Machines to run</h3>
                <ul>
                    <li>Software design</li>
                </ul>
                <ul class="fragment">
                    <p class="mark">Some considerations</p>
                    <li>Function size</li>
                    <li>Side-effects</li>
                    <li></li>
                </ul>
            </div>
        </section>


        <section data-auto-animate>
            <div class="centered-container">
                <h3 class="title">Writing code for Humans to read and Machines to run</h3>
                <ul>
                    <li>Comments / docstrings</li>
                </ul>
                <pre class="fragment show-code">
                    <code data-line-numbers data-trim class="language-python">
                        # first case: e and n vector angle
                        ez_neg = np.logical_and(e[2, :] < 0.0, eg_ig)
                        o[3, ez_neg] = 2.0*np.pi - o[3, ez_neg]

                        # second case: ex component
                        # prograde
                        ey_neg = np.logical_and(o[2, :] < np.pi*0.5, eg_il)
                        ey_neg2 = np.logical_and(ey_neg, e[1, :] < 0.0)
                        o[3, ey_neg2] = 2.0*np.pi - o[3, ey_neg2]

                        # retrograde
                        ey_neg = np.logical_and(o[2, :] > np.pi*0.5, eg_il)
                        ey_neg2 = np.logical_and(ey_neg, e[1, :] >= 0.0)
                        o[3, ey_neg2] = 2.0*np.pi - o[3, ey_neg2]
                    </code>
                </pre>
            </div>
        </section>



        <section
        data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Writing code for Humans to read and Machines to run</h3>
                <p>Lets look at some actual code:</p>
                <pre class="fragment show-code">
                    <code data-line-numbers data-trim class="language-python">

                    </code>
                </pre>

            </div>
        </section>


        <section
        data-auto-animate
        data-background-image="media/code.png"
        data-background-opacity="0.15"
        >
            <div class="centered-container">
                <h3 class="title">Writing code for Humans to read and Machines to run</h3>

            </div>
        </section>



        <section
        data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Writing code for Humans to read and Machines to run</h3>
                <p>Constant tug of war between human cognitive ease and computer efficiency</p>
                <pre class="fragment show-code">
                    <code data-line-numbers data-trim class="language-python">

                    </code>
                </pre>

            </div>
        </section>

        <section
        data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Writing code for Humans to read and Machines to run</h3>
                <p>Readable code over comments</p>
                <pre class="fragment show-code">
                    <code data-line-numbers data-trim class="language-python">

                    </code>
                </pre>

            </div>
        </section>

        <section
        data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Writing code for Humans to read and Machines to run</h3>
                <p>the README</p>
            </div>
        </section>

        <section
        data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Writing code for Humans to read and Machines to run</h3>
                <p>changelogs / git tags - help people find their way</p>
            </div>
        </section>

        <section
        data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Writing code for Humans to read and Machines to run</h3>
                <p>who is your reader?</p>
            </div>
        </section>

        <section
        data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Writing code for Humans to read and Machines to run</h3>
                <p>type hinting vs docstrings</p>
            </div>
        </section>

        <section
        data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Writing code for Humans to read and Machines to run</h3>
                <p>Docstrings, examples, and tests</p>
                <pre class="fragment show-code">
                    <code data-line-numbers data-trim class="language-python">

                    </code>
                </pre>

            </div>
        </section>

        <section
        data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Writing code for Humans to read and Machines to run</h3>
                <p>Well defined interfaces are easy to grasp and use</p>
                <pre class="fragment show-code">
                    <code data-line-numbers data-trim class="language-python">

                    </code>
                </pre>

            </div>
        </section>

        <section
        data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Writing code for Humans to read and Machines to run</h3>
                <p>markup languages to use</p>
                <p>recommendation: markdown!</p>
                <ul>
                    <li>rst</li>
                    <li>html</li>
                    <li>md</li>
                    <li>typst</li>
                </ul>
            </div>
        </section>

        <section
        data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Writing code for Humans to read and Machines to run</h3>
                <p>documentation styles in python</p>
            </div>
        </section>

        <section
        data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Writing code for Humans to read and Machines to run</h3>
                <p>building parallel docs</p>
                <ul>
                    <li>mkdocs</li>
                    <li>sphinx</li>
                    <li>pandoc</li>
                    <li>hugo</li>
                </ul>
            </div>
        </section>

        <section
        data-auto-animate
        >
            <div class="centered-container">
                <h3 class="title">Writing code for Humans to read and Machines to run</h3>
                <p>examples</p>
                <ul>
                    <li>docstring examples</li>
                    <li>docs examples</li>
                    <li>examples folder</li>
                </ul>
            </div>
        </section>
    </div>
</div>

